{% extends "base.html" %}
{% load staticfiles %}

{% block title %}Dashboard - {{ block.super }}{% endblock %}

{% block analytics %}
analytics.page("Dashboard");
{% endblock %}

{% block bodyclass %}
<body id="membership-page">
{% endblock %}

{% block content %}
<div class="container">
    <h1 class="text-center"><span class="highlight">Dashboard</span></h1>

    <div class="row">
        <!-- Main column -->
        <div class="col-md-9">
            <h2>Your products:</h2>
            <section id="memberships">
                <!-- XXX: This needs to be updated so if only one book, it doesn't go gigantic -->
                {% for membership in memberships %}
                <div class="box {{ membership.product.name|slugify }}">
                    <div class="content">
                        <h2>
                            <a href="{% url 'product_page' product_id=membership.product.name|slugify %}">
                                {{ membership.product.name }}
                            </a>
                        </h2>
                        <p class="boughton">Bought on {{ membership.created|date:"M. d, Y" }}.</p>
                        <div style="margin-top: 1em; margin-bottom: 2em;">
                            <p class="no-bottom-margin"><b>Download eBook files:</b></p>
                            <!-- XXX: This isn't the best solution but it's good enough for now -->
                            <ul>
                                {% if membership.product.name == "Hello Web App" %}
                                <li>Hello Web App: <a href="{{ hwa_pdf }}" title="Download {{ membership.product.name }} PDF">PDF</a>, <a href="{{ hwa_epub }}" title="Download {{ membership.product.name }} ePub">ePub</a>, <a href="{{ hwa_mobi }}" title="Download {{ membership.product.name }} Kindle/.mobi">.mobi/Kindle</a></li>
                                <li>Intermediate Concepts: <a href="{{ hwaic_pdf }}" title="Download {{ membership.product.name }} Intermediate Concepts PDF">PDF</a>, <a href="{{ hwaic_epub }}" title="Download {{ membership.product.name }} Intermediate Concepts ePub">ePub</a>, <a href="{{ hwaic_mobi }}" title="Download {{ membership.product.name }} Intermediate Concepts Kindle/.mobi">.mobi/Kindle</a></li>
                                {% elif membership.product.name == "Hello Web Design" %}
                                <li><a href="{{ hwd_pdf }}" title="Download {{ membership.product.name }} PDF">PDF</a></li>
                                <li><a href="{{ hwd_epub }}" title="Download {{ membership.product.name }} ePub">ePub</a></li>
                                <li><a href="{{ hwd_mobi }}" title="Download {{ membership.product.name }} Kindle/.mobi">Kindle/.mobi</a></li>
                                {% endif %}
                            </ul>
                        </div>
                        {% if membership.video %}
                        <!-- XXX: Finish videos link -->
                        <a href="" class="btn btn-primary btn-sm">Play videos</a>
                        <a href="" class="btn btn-secondary btn-sm">Visit Slack channel</a>
                        {% else %}
                        <!-- XXX: Finish upsell link -->
                        <a href="" class="btn btn-primary btn-sm">Visit Slack channel</a>
                        <a href="" class="btn btn-secondary btn-sm">Upgrade: Buy video course for 20% off ({% if membership.product.name == "Hello Web App" %}$79{% elif membership.product.name == "Hello Web Design" %}$49{% endif %})</a>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </section>

            {% if not has_hwd or not has_hwa %}
            <hr />
            <h4>Want to buy another <i>Hello Web Books</i> product?</h4>
            <section id="upsells">
                {% if not has_hwd %}
                <div class="box hello-web-design">
                    <div class="content">
                        <h5>Hello Web Design</h5>
                        <p>Learn web design fundamentals and shortcuts. Everything you need to learn just enough design for your projects.</p>
                        <p>Use the coupon code <b>CUSTOMER</b> for 20% off.</p>
                        <a href="{% url 'learn-design' %}" class="btn btn-secondary btn-sm">See product page</a>
                    </div>
                </div>
                {% endif %}
                {% if not has_hwa %}
                <div class="box hello-web-app">
                    <div class="content">
                        <h5>Hello Web App</h5>
                        <p>Create a unique web app using Python 3 and Django 2.0 and launch on Heroku. Two book set.</p>
                        <p>Use the coupon code <b>CUSTOMER</b> for 20% off.</p>
                        <a href="{% url 'learn-django' %}" class="btn btn-secondary btn-sm">See product page</a>
                    </div>
                </div>
                {% endif %}
            </section>
            {% else %}
            <p class="text-center super-vertical-margin">You have every book I offer! Thank you. ðŸ’•</p>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-md-3 sidebar">
            <h4>Administration</h4>
            <ul class="list-unstyled">
                <li><a href="{% url 'charge_update' %}">Update or cancel payment details</a></li>
                <li><a href="{% url 'password_change' %}">Update password</a></li>
                <li><a href="{% url 'edit_email' %}">Update email</a></li>
                <li><a href="{% url 'auth_logout' %}">Logout</a></li>
            </ul>
        </div>
    </div>
</div>
{% endblock content %}
